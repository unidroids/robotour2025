<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8" />
    <title>Test kamer – Robotour</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        #wrapper {
            display: flex;
            height: 100%;
        }

        #viewer {
            flex: 1;
            background: #ffffdd;
            /* display: flex; */
            flex-direction: column;
            gap: 1rem;
            padding-left: 3rem;
            box-sizing: border-box;
            overflow-y: auto;
        }

        #cameraImg {
            /* flex: 1; */
            display: block;
            max-width: 90%;
            max-height: 90%;
            padding-left: 3rem;
            height: auto;
            object-fit: contain;
            background: black;
        }

        #camOutput {
            /* flex: 1; */
            background-color: #ffffdd;
            padding: 1rem;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        #controls {
            flex: 1;
            background: #eee;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            overflow-y: auto;
        }

        button {
            padding: 1rem;
            font-size: 1.1rem;
            cursor: pointer;
        }
    </style>
    <script>
        function fixHeight() {
            const h = window.innerHeight + "px";
            document.getElementById("wrapper").style.height = h;
        }
        window.addEventListener("load", fixHeight);
        window.addEventListener("resize", fixHeight);
    </script>

</head>

<body>
    <div id="wrapper">
        <div id="viewer">
            <div id="camOutput">⬅ Výstup z kamery, QR kód nebo log</div>
            <img id="cameraImg" src="" alt="Kamera" />
        </div>

        <div id="controls">
            <button onclick="camCmd('status')">Status</button>
            <button onclick="camCmd('start')">Start</button>
            <button onclick="camCmd('lcam')">Levá kamera</button>
            <button onclick="camCmd('rcam')">Pravá kamera</button>
            <button onclick="camCmd('qr')">QR Code</button>
            <button onclick="camCmd('stop')">Stop</button>
            <hr />
            <button onclick="location.href='/'">⏮ Zpět na hlavní panel</button>
        </div>
    </div>

    <script>
        const img = document.getElementById("cameraImg");
        const result = document.getElementById("camOutput");

        async function camCmd(cmd) {
            try {
                const r = await fetch(`/camera/${cmd}`);
                if (!r.ok) throw new Error(await r.text());
                const data = await r.json();
                log(JSON.stringify(data, null, 2));

                // pro streamovací příkazy přepni <img> na příslušný endpoint
                if (cmd === 'lcam' || cmd === 'rcam') {
                    img.src = `/camera/${cmd}_stream?ts=` + Date.now();   // cache-buster
                    img.style.display = "block";
                    //viewer.style.display = "none";
                }
            } catch (e) {
                log("❌ " + e.message);
            }
        }

        function log(t) { result.textContent = t; }
    </script>
</body>

</html>